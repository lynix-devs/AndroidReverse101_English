# **ğŸ“œ Day 5: æ±‡ç¼–è¯­è¨€åŸºç¡€**

## **ğŸ“Œ å­¦ä¹ ç›®æ ‡**
âœ… äº†è§£ **æ±‡ç¼–è¯­è¨€** çš„åŸºæœ¬æ¦‚å¿µåŠå…¶åœ¨è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­çš„ä½œç”¨ã€‚  
âœ… å­¦ä¹  **x86 æ±‡ç¼–ã€ARM æ±‡ç¼–ã€Smaliï¼ˆDEX å­—èŠ‚ç ï¼‰** ä¸‰ç§æ±‡ç¼–è¯­è¨€çš„åŸºç¡€ã€‚  
âœ… æŒæ¡ **å¯„å­˜å™¨ã€æŒ‡ä»¤æ ¼å¼ã€æ•°æ®ä¼ è¾“ã€ç®—æœ¯è¿ç®—ã€æ§åˆ¶æµ** ç­‰æ±‡ç¼–è¯­è¨€æ ¸å¿ƒæ¦‚å¿µã€‚  
âœ… é€šè¿‡ **å®é™…ç¤ºä¾‹** å­¦ä¹ æ±‡ç¼–å¦‚ä½•ä¸ C è¯­è¨€è¿›è¡Œäº¤äº’ï¼Œå¹¶å®ç°ç®€å•çš„æ±‡ç¼–ç¨‹åºã€‚  
âœ… å­¦ä¹  **æ±‡ç¼–åœ¨é€†å‘å·¥ç¨‹å’Œæ¼æ´åˆ©ç”¨ä¸­çš„ä½œç”¨**ï¼Œå¹¶è¿›è¡Œç®€å•çš„è°ƒè¯•å’Œåˆ†æã€‚

---

# **1ï¸âƒ£ ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€ï¼Ÿ**
**æ±‡ç¼–è¯­è¨€ï¼ˆAssembly Languageï¼‰** æ˜¯ **ä½çº§ç¼–ç¨‹è¯­è¨€**ï¼Œå®ƒä½¿ç”¨ **åŠ©è®°ç¬¦ï¼ˆMnemonicï¼‰** ä»£æ›¿äºŒè¿›åˆ¶æŒ‡ä»¤ï¼Œä½¿å¾—ç¨‹åºå‘˜å¯ä»¥æ›´æ–¹ä¾¿åœ°æ§åˆ¶è®¡ç®—æœºç¡¬ä»¶ã€‚  

| **è¯­è¨€å±‚çº§** | **ç¤ºä¾‹** |
|---------|----------------------|
| **é«˜çº§è¯­è¨€ï¼ˆCã€Pythonï¼‰** | `int a = 5;` |
| **æ±‡ç¼–è¯­è¨€ï¼ˆx86ã€ARMï¼‰** | `MOV R0, #5` |
| **æœºå™¨ç ï¼ˆ16 è¿›åˆ¶æŒ‡ä»¤ï¼‰** | `B8 05 00 00 00` |

æ±‡ç¼–è¯­è¨€ä¸ç‰¹å®š CPU æŒ‡ä»¤é›†ç´§å¯†ç›¸å…³ï¼Œå¦‚ï¼š
- **x86 æ±‡ç¼–**ï¼ˆIntelã€AMD å¤„ç†å™¨ï¼‰
- **ARM æ±‡ç¼–**ï¼ˆç§»åŠ¨è®¾å¤‡ã€åµŒå…¥å¼è®¾å¤‡ï¼‰
- **Smali æ±‡ç¼–**ï¼ˆAndroid DEX å­—èŠ‚ç ï¼‰

---

# **2ï¸âƒ£ x86 æ±‡ç¼–åŸºç¡€**
### **ğŸ”¹ x86 å¤„ç†å™¨æ¶æ„**
x86 é‡‡ç”¨ **CISCï¼ˆå¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœºï¼‰**ï¼Œæ”¯æŒ **å¯å˜é•¿æŒ‡ä»¤** å’Œ **ä¸°å¯Œçš„å¯»å€æ¨¡å¼**ã€‚

**x86 32 ä½ï¼ˆIA-32ï¼‰å¯„å­˜å™¨**
| **å¯„å­˜å™¨** | **ç”¨é€”** |
|---------|------------|
| EAX | ç´¯åŠ å™¨ï¼ˆè¿ç®—/è¿”å›å€¼ï¼‰ |
| EBX | åŸºå€å¯„å­˜å™¨ |
| ECX | è®¡æ•°å¯„å­˜å™¨ï¼ˆå¾ªç¯ï¼‰ |
| EDX | æ•°æ®å¯„å­˜å™¨ |
| ESI | æºç´¢å¼•å¯„å­˜å™¨ |
| EDI | ç›®æ ‡ç´¢å¼•å¯„å­˜å™¨ |
| EBP | æ ˆåŸºå€æŒ‡é’ˆ |
| ESP | æ ˆæŒ‡é’ˆ |

### **ğŸ”¹ x86 æŒ‡ä»¤ç¤ºä¾‹**
```assembly
section .text
global _start

_start:
    mov eax, 5      ; EAX = 5
    add eax, 10     ; EAX = EAX + 10
    sub eax, 2      ; EAX = EAX - 2
    int 0x80        ; ç³»ç»Ÿè°ƒç”¨
```
ğŸ“Œ **ç‰¹ç‚¹**ï¼š
- `mov eax, 5`ï¼šå°† 5 èµ‹å€¼ç»™ `eax`ã€‚  
- `add eax, 10`ï¼šå¯¹ `eax` è¿›è¡ŒåŠ æ³•è¿ç®—ã€‚  
- `int 0x80`ï¼šè°ƒç”¨ Linux ç³»ç»Ÿ APIã€‚

---

# **3ï¸âƒ£ ARM æ±‡ç¼–åŸºç¡€**
### **ğŸ”¹ ARM å¤„ç†å™¨æ¶æ„**
ARM é‡‡ç”¨ **RISCï¼ˆç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼‰**ï¼ŒæŒ‡ä»¤é•¿åº¦å›ºå®šï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œå¹¿æ³›ç”¨äº **ç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼ç³»ç»Ÿ**ã€‚

**ARMv7ï¼ˆARM32ï¼‰å¯„å­˜å™¨**
| **å¯„å­˜å™¨** | **ç”¨é€”** |
|---------|--------|
| R0-R3 | ä¼ é€’å‡½æ•°å‚æ•° |
| R4-R11 | é€šç”¨å¯„å­˜å™¨ |
| R12 | è¿‡ç¨‹è°ƒç”¨å¯„å­˜å™¨ |
| R13 | æ ˆæŒ‡é’ˆï¼ˆSPï¼‰ |
| R14 | é“¾æ¥å¯„å­˜å™¨ï¼ˆLRï¼‰ |
| R15 | ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ |

**ARMv8ï¼ˆARM64ï¼‰å¯„å­˜å™¨**
| **å¯„å­˜å™¨** | **ç”¨é€”** |
|---------|--------|
| X0-X7 | ä¼ é€’å‚æ•°å’Œè¿”å›å€¼ |
| X8 | ç³»ç»Ÿè°ƒç”¨ |
| X9-X15 | ä¸´æ—¶å˜é‡ |
| X19-X30 | é€šç”¨å¯„å­˜å™¨ |
| X30 (LR) | é“¾æ¥å¯„å­˜å™¨ |

### **ğŸ”¹ ARM æŒ‡ä»¤ç¤ºä¾‹**
```assembly
.global _start
_start:
    MOV R0, #5      ; èµ‹å€¼ 5 ç»™ R0
    ADD R0, R0, #3  ; R0 = R0 + 3
    LDR R1, [R2]    ; è¯»å– R2 æŒ‡å‘çš„å†…å­˜åˆ° R1
    STR R1, [R3]    ; å­˜å‚¨ R1 åˆ° R3 æŒ‡å‘çš„å†…å­˜
    B _start        ; æ— é™å¾ªç¯
```

---

# **4ï¸âƒ£ Smaliï¼ˆAndroid DEX æ±‡ç¼–ï¼‰**
**Smali æ˜¯ Android DEXï¼ˆDalvik Executableï¼‰æ–‡ä»¶çš„æ±‡ç¼–è¯­è¨€**ï¼Œç›¸å½“äº Java å­—èŠ‚ç çš„æ±‡ç¼–ç‰ˆæœ¬ã€‚

### **ğŸ”¹ Smali ä»£ç ç¤ºä¾‹**
```smali
.method public static sum(II)I
    .registers 3
    add-int v0, p0, p1
    return v0
.end method
```

### **ğŸ”¹ Smali ç ´è§£ç¤ºä¾‹**
```smali
.method public isVip()Z
    .registers 2
    const/4 v0, 0x1  # è®©æ‰€æœ‰ç”¨æˆ·å˜æˆ VIP
    return v0
.end method
```
ğŸ“Œ **ä¿®æ”¹ Smali ä»£ç å¯ç”¨äºç»•è¿‡ Android åº”ç”¨çš„ VIP é™åˆ¶**ã€‚

---

# **5ï¸âƒ£ æ±‡ç¼–ä¸ C è¯­è¨€çš„äº¤äº’**
### **ğŸ”¹ C è¯­è¨€è°ƒç”¨ x86 æ±‡ç¼–**
```c
#include <stdio.h>

int add(int a, int b) {
    int result;
    __asm__ (
        "addl %%ebx, %%eax;"
        : "=a" (result)
        : "a" (a), "b" (b)
    );
    return result;
}

int main() {
    printf("Result: %d\n", add(5, 10));
    return 0;
}
```

### **ğŸ”¹ C è¯­è¨€è°ƒç”¨ ARM æ±‡ç¼–**
```c
int add(int a, int b) {
    int result;
    __asm__ (
        "ADD %0, %1, %2"
        : "=r" (result)
        : "r" (a), "r" (b)
    );
    return result;
}
```

---

# **ğŸ›  å®æˆ˜ä»»åŠ¡**
### **âœ… 1. ç¼–å†™å¹¶è¿è¡Œ x86 æ±‡ç¼–**
```bash
nasm -f elf64 test.asm
ld -o test test.o
./test
```

### **âœ… 2. è¿è¡Œ ARM æ±‡ç¼–**
```assembly
.global _start
_start:
    MOV R0, #1
    LDR R1, =message
    MOV R2, #13
    MOV R7, #4
    SWI 0
    MOV R7, #1
    SWI 0

.section .data
message: .ascii "Hello, ARM!\n"
```

### **âœ… 3. åç¼–è¯‘ APK å¹¶ä¿®æ”¹ Smali**
```bash
apktool d app.apk -o output
vim output/smali/com/example/Main.smali
```

---

# **ğŸ“š å‚è€ƒèµ„æ–™**
ğŸ“Œ **x86 æ±‡ç¼–**
- `x86 æŒ‡ä»¤æ‰‹å†Œ`ï¼š[https://www.felixcloutier.com/x86/](https://www.felixcloutier.com/x86/)  
- `NASM æ‰‹å†Œ`ï¼š[https://nasm.us](https://nasm.us)  

ğŸ“Œ **ARM æ±‡ç¼–**
- `ARM æŒ‡ä»¤æ‰‹å†Œ`ï¼š[https://developer.arm.com/documentation](https://developer.arm.com/documentation)  
- `AArch64 æ±‡ç¼–æŒ‡å—`ï¼š[https://azeria-labs.com/](https://azeria-labs.com/)  

ğŸ“Œ **Smali**
- `Smali æ•™ç¨‹`ï¼š[https://github.com/JesusFreke/smali](https://github.com/JesusFreke/smali)  

---

ğŸ”¥ **ä»»åŠ¡å®Œæˆåï¼Œä½ å°†æŒæ¡ï¼š**  
âœ… **x86ã€ARMã€Smali æ±‡ç¼–è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ã€‚**  
âœ… **æ±‡ç¼–å¦‚ä½•ä¸ C è¯­è¨€äº¤äº’ã€‚**  
âœ… **è¿è¡Œã€ä¿®æ”¹å’Œè°ƒè¯•æ±‡ç¼–ä»£ç ã€‚**  

ğŸš€ **ä¸‹ä¸€æ­¥ï¼ˆDay 6ï¼‰**ï¼š**x86 vs. ARM æ±‡ç¼–å¯¹æ¯”ï¼** ğŸ¯  